{
  "parseSpend": {
    "system": "Eres un parser financiero para español (España). Devuelves SIEMPRE JSON válido sin texto extra.",
    "instruction": "Extrae {amount_eur}, {category}, {merchant}, {note}, {paid_with}, {confidence} de la frase del usuario.\n- Admite formatos: '10,55', '10.55', '10 con 55', '€10', '10 euros'.\n- Si hay varias cantidades, elige la más probable como IMPORTE.\n- Categoriza en una de: ['Café','Comida fuera','Supermercado','Transporte','Ocio','Hogar','Salud','Compras','Otros'].\n- {merchant} es el establecimiento (Zara, Starbucks, etc.).\n- {paid_with} detecta forma de pago: 'tarjeta', 'efectivo', 'transferencia' o null si no se menciona.\n- {note} es el comentario o descripción de los artículos (ej: 'una camiseta', '2 pantalones', 'camiseta y 2 pantalones').\n- {confidence} en 0..1 (≥0.8 auto‑confirm).\n- IMPORTANTE: El usuario puede decir los campos en cualquier orden.\nResponde SOLO con JSON.",
    "schema": {
      "type": "object",
      "properties": {
        "amount_eur": {
          "type": "number"
        },
        "category": {
          "type": "string"
        },
        "merchant": {
          "type": "string"
        },
        "note": {
          "type": "string"
        },
        "paid_with": {
          "type": "string",
          "enum": ["tarjeta", "efectivo", "transferencia", null]
        },
        "confidence": {
          "type": "number"
        }
      },
      "required": [
        "amount_eur",
        "category",
        "confidence"
      ]
    },
    "examples": [
      {
        "input": "3€ una camiseta en zara con tarjeta",
        "output": {
          "amount_eur": 3.0,
          "category": "Compras",
          "merchant": "Zara",
          "note": "una camiseta",
          "paid_with": "tarjeta",
          "confidence": 0.95
        }
      },
      {
        "input": "3€ con tarjeta en zara una camiseta y 2 pantalones",
        "output": {
          "amount_eur": 3.0,
          "category": "Compras",
          "merchant": "Zara",
          "note": "una camiseta y 2 pantalones",
          "paid_with": "tarjeta",
          "confidence": 0.95
        }
      },
      {
        "input": "Café 1 con 80 en el bar de abajo",
        "output": {
          "amount_eur": 1.8,
          "category": "Café",
          "merchant": "bar de abajo",
          "note": "",
          "paid_with": null,
          "confidence": 0.93
        }
      },
      {
        "input": "10 euros camiseta el corte inglés en efectivo",
        "output": {
          "amount_eur": 10.0,
          "category": "Compras",
          "merchant": "El Corte Inglés",
          "note": "camiseta",
          "paid_with": "efectivo",
          "confidence": 0.92
        }
      },
      {
        "input": "Taxi 6€",
        "output": {
          "amount_eur": 6.0,
          "category": "Transporte",
          "merchant": "Taxi",
          "note": "",
          "paid_with": null,
          "confidence": 0.95
        }
      },
      {
        "input": "Super 35,70 con tarjeta",
        "output": {
          "amount_eur": 35.7,
          "category": "Supermercado",
          "merchant": "",
          "note": "",
          "paid_with": "tarjeta",
          "confidence": 0.92
        }
      },
      {
        "input": "10 con 50 céntimos de coca cola en efectivo",
        "output": {
          "amount_eur": 10.5,
          "category": "Café",
          "merchant": "",
          "note": "coca cola",
          "paid_with": "efectivo",
          "confidence": 0.88
        }
      },
      {
        "input": "parking 2 horas 3€ transferencia",
        "output": {
          "amount_eur": 3.0,
          "category": "Transporte",
          "merchant": "Parking",
          "note": "2 horas",
          "paid_with": "transferencia",
          "confidence": 0.91
        }
      },
      {
        "input": "en starbucks un cappuccino 4,50 con tarjeta",
        "output": {
          "amount_eur": 4.5,
          "category": "Café",
          "merchant": "Starbucks",
          "note": "un cappuccino",
          "paid_with": "tarjeta",
          "confidence": 0.94
        }
      }
    ]
  },
  "fallbackParser": {
    "system": "Eres un parser básico. Si no encuentras importe claro, devuelve confidence < 0.5.",
    "instruction": "Intenta extraer lo que puedas. Si falta el importe o es ambiguo, marca confidence muy bajo (0.2-0.4) para que el usuario confirme manualmente."
  },
  "merchantNormalizer": {
    "rules": [
      {"pattern": "corte ingles|el corte|corteingles", "normalized": "El Corte Inglés"},
      {"pattern": "mercadona", "normalized": "Mercadona"},
      {"pattern": "carrefour", "normalized": "Carrefour"},
      {"pattern": "lidl", "normalized": "Lidl"},
      {"pattern": "dia|supermercados dia", "normalized": "DIA"}
    ]
  },
  "microMessages": {
    "ok": [
      "¡Listo! {category} {amount} € guardado.",
      "He registrado {amount} € en {category}.",
      "Anotado ✅ {category}: {amount} €."
    ],
    "warn": [
      "Vas alto en {category} este mes. ¿Revisamos mañana?",
      "Casi alcanzas el límite. Quedan {remaining} €."
    ],
    "error": [
      "No he entendido el importe. ¿Puedes repetir?",
      "Parece ruido. Si quieres, tecleo rápido."
    ],
    "undoToast": "Gasto guardado. Deshacer (5s)"
  },
  "insightsMonthly": {
    "system": "Eres un analista financiero amable. Resumes en 3 frases claras.",
    "instruction": "Con totales por categoría y cambios vs mes pasado, genera 3 insights prácticos y breves en español, sin regañar.",
    "example_input": {
      "Supermercado": {
        "total": 180,
        "delta_pct": -5
      },
      "Ocio": {
        "total": 120,
        "delta_pct": 18
      },
      "Café": {
        "total": 36,
        "delta_pct": 20
      }
    },
    "example_output": [
      "Has reducido Supermercado un 5 %. Bien ahí.",
      "Ocio sube un 18 %. Si lo limitas a 90 €, cumples tu objetivo.",
      "Café crece un 20 %. Cambiar a cápsulas te ahorraría ~8 €/mes."
    ]
  }
}